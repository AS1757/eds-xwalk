var st,__extends=this&&this.__extends||function(t,e){function r(){this.constructor=t}for(var o in e)e.hasOwnProperty(o)&&(t[o]=e[o]);t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)};!function(t){var e;!function(t){angular.module("st.search",[]),t.UrlSeparator=":",t.DefaultGroup="",t.TermPropertyName="term",t.PagePropertyName="page";var e=function(t){function e(e,r,o,s){var i=$(s);o<2?(i.text("Search must be two or more characters."),i.removeClass("hidden")):o>500?(i.text("Search may not be over 500 characters"),i.removeClass("hidden")):t.location.pathname.toLocaleUpperCase()===r.toLocaleUpperCase()?(t.location.hash="/?term="+encodeURIComponent(e),i.addClass("hidden")):(t.location.assign(r+"#/?term="+encodeURIComponent(e)),i.addClass("hidden"))}return{restrict:"A",link:function(t,r,o){var s=angular.element(o.stSearchBoxInput||".form-control",r),i=angular.element(o.stSearchBoxButton||".btn",r),n=$("#searchHelpBlock")[0];o.stSearchBox&&1===s.length&&i.length&&(s.on("keypress",function(r){13===r.keyCode&&s.val()&&(r.preventDefault(),r.stopPropagation(),t.$apply(function(){e(s.val(),o.stSearchBox,$(s).val().length,n)}))}),i.on("click",function(r){s.val()&&t.$apply(function(){e(s.val(),o.stSearchBox,$(s).val().length,n)})}))}}};e.$inject=["$window"],angular.module("st.search").directive("stSearchBox",e)}(e=t.search||(t.search={}))}(st||(st={})),function(t){var e;!function(t){var e=function(){function e(e,r){var o=this;this.group=t.DefaultGroup,e.$on("stRegisterFacets",function(t){r.addConstantFilters(o.group,o.filters)})}return e.$inject=["$rootScope","stFacetService"],e}();angular.module("st.search").controller("stConstantFiltersCtrl",e)}(e=t.search||(t.search={}))}(st||(st={})),function(t){var e;!function(t){var e=function(){function e(e,r,o){var s=this;this.facetService=r,this.$log=o,this.group=t.DefaultGroup,this.allowMultiple=!1,this._items=new t.models.FacetItemCollection,this._items.addWatch(function(){s.notify()}),e.$on("stRegisterFacets",function(t){s.facetService.registerFacets(s.group,s.name,s._items)}),e.$on("stFacetsInit",function(t,e,r){var o=e[s.name]||[],i=s._items.setSelectedNames(o,!1);i&&r.push(s.group)})}return Object.defineProperty(e.prototype,"items",{get:function(){return this._items},set:function(e){var r=this;this._items.length=0,e.forEach(function(e){r._items.push(angular.extend(new t.models.FacetItem(r._items),e))})},enumerable:!0,configurable:!0}),e.prototype.modelChanged=function(){var t=this.model?Array.isArray(this.model)?this.model:[this.model]:[];this._items.setSelectedIds(t)},e.prototype.toggle=function(t){this._items.toggle(t,this.allowMultiple)},e.prototype.add=function(t){this._items.select(t,this.allowMultiple)},e.prototype.remove=function(t){this._items.deselect(t)},e.prototype.notify=function(){this.facetService.update(this.name,this.group)},e.$inject=["$rootScope","stFacetService","$log"],e}();angular.module("st.search").controller("stFacetItemsCtrl",e)}(e=t.search||(t.search={}))}(st||(st={})),function(t){var e;!function(t){function e(t){var e,r=[];for(e=1;e<arguments.length;e++)r[e-1]=arguments[e];r&&r.length&&r.forEach(function(e){t.indexOf(e)===-1&&t.push(e)})}var r=function(){function r(r,o,s,i,n,a){var c=this;this.$rootScope=o,this.$location=s,this.$http=i,this.$q=n,this.$log=a,this.facetGroups={},this.isSearching={},this.isTypeAhead={},this.results={},this._firstLoad=!0,this._registeredGroups=[],this._groupsUpdated=null,this._constantFilters={},r.has("stSearchConfig")&&r.has("stSearchGroupConfig")?(this._stSearchConfig=r.get("stSearchConfig"),this._stSearchGroupConfig=r.get("stSearchGroupConfig")):a.error("Search Configuration was never declared. You must place a Facet Search Results widget on the page."),o.$on("$locationChangeSuccess",function(r,i,n){var u,h,l;c._firstLoad&&(o.$emit("stRegisterFacets"),u=Object.keys(c.facetGroups),u.unshift(c._registeredGroups),e.apply(null,u)),c._groupsUpdated||(h=angular.copy(s.search()),h.page&&delete h.page,angular.forEach(h,function(e,r){r!==t.TermPropertyName&&(h[r]=e.split(t.UrlSeparator))}),l=[],o.$emit("stFacetsInit",h,l),l.forEach(function(t){c.groupUpdated(t)})),c._firstLoad&&c._registeredGroups.forEach(function(t){var e=c._stSearchGroupConfig[t];e.searchOnLoad&&c.groupUpdated(t)}),c._groupsUpdated&&c._groupsUpdated.length&&(a.debug("perform search",c._groupsUpdated),c._groupsUpdated.forEach(function(t){c.submitSearch(t)}),c._groupsUpdated=null),c._firstLoad=!1})}return r.prototype.registerFacets=function(e,r,o){e=e||t.DefaultGroup;var s=this.facetGroups[e]=this.facetGroups[e]||{};r&&o&&(Array.isArray(o)?o.length&&(s[r]=o):s[r]=o)},r.prototype.setPage=function(e,r){r=r||t.DefaultGroup;var o=this.getPageId(r);o!==e&&(this.$location.search(t.PagePropertyName,e>1?e:null),this.groupUpdated(r))},r.prototype.addConstantFilters=function(r,o){var s,i=!1;r=r||t.DefaultGroup,s=this._constantFilters[r]=this._constantFilters[r]||{},angular.forEach(o,function(t,e){var r,o=s[e]=s[e]||[];for(r=0;r<t.length;r++)t[r]&&(o.push(t[r]),i=!0)}),i&&e(this._registeredGroups,r)},r.prototype.update=function(e,r,o){var s,i,n,a,c;if(void 0===o&&(o=!0),r=r||t.DefaultGroup,s=this.facetGroups[r]){if(i=null,n=null,e===t.TermPropertyName){if(s.term&&(s.term.term&&(i=s.term.term),s.term.id&&(n=s.term.id)),!s.term||!s.term.term)return s.term.model="",void(s.term.results=null)}else i=s[e],a=void 0,a=i.reduce(function(t,e){return e.selected&&(t=!0),t},a),a&&s.term&&s.term.term&&(s.term.term=void 0),s&&s.term&&(s.term.model="",s.term.results=null);this.updateUrl(i,e,n),c=this.getPageId(r),1!==c&&this.$location.search(t.PagePropertyName,null),o&&this.groupUpdated(r),this.$rootScope.$emit("stSearchUpdated",r,e,i),this.$log.debug("stFacetUpdated",r,e,i)}},r.prototype.updateTypeGroup=function(e,r){r=r||t.DefaultGroup,this.isTypeAhead[r]=!0;var o=this.facetGroups[r];o&&(this.groupUpdated(r),this.submitSearch(r,!0))},r.prototype.updateUrl=function(e,r,o){var s;e?"string"==typeof e?s=e:e.length&&(s=e.reduce(function(t,e){return e.selected&&t.push(e.name),t},[]).join(t.UrlSeparator)):s=null,s||(s=null),this.$location.path()||this.$location.path("/"),this.$location.search(r,s).search("id",o)},r.prototype.submitSearch=function(e,r){var o,s,i,n,a,c,u,h,l,p,d=this;if(void 0===r&&(r=!1),o={Filters:{},Group:e},s=window,this._stSearchConfig&&this._stSearchGroupConfig){if(i=!1,n=!1,a=this._stSearchGroupConfig[e],!a.indexName)return void this.$log.error("Search Index not specified for",e?'group: "'+e+'"':"default group");if(o.ItemsPerPage=a.itemsPerPage,o.OrFacets=a.orFacets,c=this._constantFilters[e]||{},angular.forEach(c,function(t,e){var r,s=o.Filters[e]=[];if(e&&t)for(r=0;r<t.length;r++)t[r]&&(s.push(t[r]),n=!0)}),u=this.facetGroups[e],angular.forEach(u,function(e,s){var n,a;s===t.TermPropertyName?(n=e,n&&(r?n.typeterm&&(o.Term=n.typeterm):n.term&&(o.Term=n.term),n.id&&(o.Id=n.id),n.orderby&&(o.OrderBy=n.orderby),n.sortorder&&(o.SortOrder=n.sortorder))):(a=e,a.forEach(function(t){t.selected&&!r&&((o.Filters[s]=o.Filters[s]||[]).push(t.id),i=!0)}))}),i||n||delete o.Filters,r)o.Term?(o.Skip=0,h=[],o.ItemsPerPage=10,h.push(this.submitSearchReq(o,a.indexName)),this.$q.all(h).then(function(t){var r,o;s.dataLayer&&s.dataLayer.push({event:"FAQ_SearchResultsLoad"}),r=t.map(function(t){return t.data}),o=1===r.length?r[0]:r,d.$rootScope.$emit("stTypeAheadResponse",o,e),d.$log.debug("Search result for group:",e,"; Result:",o)},function(t){d.$log.error("Error submitting search for group:",e,"; Error data:",t)})):(this.$rootScope.$emit("stTypeAheadResponse",null,e),this.$log.debug("Search Cleared for group:",e));else if(a.allowEmptySearch||o.Term||i){if(this.isSearching[e]=!0,this.isTypeAhead[e]=!1,h=[],l=this.getPageId(e),o.Skip=o.ItemsPerPage*(l-1),p=this.submitSearchReq(o,a.indexName),l>1&&this._firstLoad&&a.loadAllPagesOnInit)for(;l>1;)l--,o=angular.copy(o),o.Skip=o.ItemsPerPage*(l-1),h.push(this.submitSearchReq(o,a.indexName));h.push(p),this.$q.all(h).then(function(t){var r,o;s.dataLayer&&s.dataLayer.push({event:"FAQ_SearchResultsLoad"}),r=t.map(function(t){return t.data}),o=1===r.length?r[0]:r,d.results[e]=r[r.length-1],d.$rootScope.$emit("stSearchResponse",o,e),d.$log.debug("Search result for group:",e,"; Result:",o)},function(t){d.$log.error("Error submitting search for group:",e,"; Error data:",t)}).finally(function(){d.isSearching[e]=!1})}else this.results[e]=null,this.$rootScope.$emit("stSearchResponse",null,e),this.$log.debug("Search Cleared for group:",e)}},r.prototype.getPageId=function(e){var r,o,s=this.$location.search();return r=this._registeredGroups.length>1?s[(e||t.DefaultGroup)+t.UrlSeparator+t.PagePropertyName]:s.page,r&&(o=parseInt(r,10),o>1)?o:1},r.prototype.submitSearchReq=function(t,e){return this.$http.post(this._stSearchConfig.endpoint+"/"+e,t)},r.prototype.groupUpdated=function(r){this._groupsUpdated||(this._groupsUpdated=[]),e(this._groupsUpdated,r||t.DefaultGroup)},r.$inject=["$injector","$rootScope","$location","$http","$q","$log"],r}();angular.module("st.search").service("stFacetService",r)}(e=t.search||(t.search={}))}(st||(st={})),function(t){var e;!function(t){var e;!function(t){var e,r=function(){function t(t){this._parent=t,this._selected=!1}return Object.defineProperty(t.prototype,"selected",{get:function(){return this._selected},set:function(t){this._selected!==t&&(this._selected=t,this._parent.notify())},enumerable:!0,configurable:!0}),t}();t.FacetItem=r,e=function(t){function e(){t.apply(this,arguments),this._watchers=[],this._notificationCtx=null}return __extends(e,t),e.prototype.indexOfId=function(t){for(var e=0;e<this.length;e++)if(t===this[e].id)return e;return-1},e.prototype.indexOfName=function(t){for(var e=0;e<this.length;e++)if(t===this[e].name)return e;return-1},e.prototype.addWatch=function(t){this._watchers.push(t)},e.prototype.notify=function(){this._notificationCtx?this._notificationCtx.notified=!0:this._watchers.forEach(function(t){t()})},e.prototype.suppressNotify=function(t){var e,r;return!!t&&(e=this._notificationCtx,this._notificationCtx={notified:!1},t(),r=this._notificationCtx.notified,this._notificationCtx=e,r)},e.prototype.clearSelected=function(t){var e,r=this;return void 0===t&&(t=!0),e=this.suppressNotify(function(){r.forEach(function(t){t.selected=!1})}),e&&t&&this.notify(),e},e.prototype.setSelectedIds=function(t,e){void 0===e&&(e=!0);var r=this.setSelected(t,"id");return r&&e&&this.notify(),r},e.prototype.setSelectedNames=function(t,e){void 0===e&&(e=!0);var r=this.setSelected(t,"name");return r&&e&&this.notify(),r},e.prototype.setSelected=function(t,e){var r=this,o=this.suppressNotify(function(){r.forEach(function(r){r.selected=!!t&&t.indexOf(r[e])>=0})});return o},e.prototype.findItem=function(t){var e,r=null;return"undefined"!=typeof t&&(this.indexOf(t)>-1?r=t:"number"==typeof t?r=this[t]:t.id&&(e=this.indexOfId(t.id))>-1?r=this[e]:t.name&&(e=this.indexOfName(t.name))>-1&&(r=this[e])),r},e.prototype.toggle=function(t,e){var r=this.findItem(t);r&&(r.selected?r.selected=!1:(e||this.clearSelected(!1),r.selected=!0))},e.prototype.select=function(t,e){var r=this.findItem(t);r&&!r.selected&&(e||this.clearSelected(!1),r.selected=!0)},e.prototype.deselect=function(t){var e=this.findItem(t);e&&e.selected&&(e.selected=!1)},e}(Array),t.FacetItemCollection=e}(e=t.models||(t.models={}))}(e=t.search||(t.search={}))}(st||(st={})),function(t){var e;!function(t){var e=function(){function e(e,r){var o=this;this.stFacetService=r,this.group=t.DefaultGroup,e.$on("stRegisterFacets",function(e){r.registerFacets(o.group,t.TermPropertyName,o)}),e.$on("stFacetsInit",function(t,e,r){o._term===e.term&&o.model===e.term||(o._term=o.model=e.term,r.push(o.group))})}return Object.defineProperty(e.prototype,"term",{get:function(){return this._term},set:function(e){this._term!==e&&(this._term=this.model=e,this.stFacetService.update(t.TermPropertyName,this.group))},enumerable:!0,configurable:!0}),e.prototype.notify=function(){this.term=this.model},e.$inject=["$rootScope","stFacetService"],e}();angular.module("st.search").controller("stTermFacetCtrl",e)}(e=t.search||(t.search={}))}(st||(st={})),function(t){var e;!function(t){var e=function(){function e(e,r){var o=this;this.stFacetService=r,this.group=t.DefaultGroup,this.showResults=!1,this.orderby="Sticky",this.sortorder="desc",e.$on("stRegisterFacets",function(e){r.registerFacets(o.group,t.TermPropertyName,o)}),e.$on("stFacetsInit",function(t,e,r){o._term===e.term&&o.id===e.id&&o.model===e.term||(o._term!==e.term&&(o._term=o.model=e.term),o._id!==e.id&&(o._id=e.id),r.push(o.group))}),e.$on("stTypeAheadResponse",function(t,e,r){angular.isUndefined(r)||r!==o.group||(Array.isArray(e)?e.length&&(o.results=e[e.length-1],o.showResults=!0):(o.results=e,o.showResults=!0),o.results&&o.results.Results.push({Id:"-1",DisplayQuestion:"Show all results"}))})}return Object.defineProperty(e.prototype,"id",{get:function(){return this._id},set:function(t){this._id=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"term",{get:function(){return this._term},set:function(e){this._term!==e&&(this._term=this.model=e,this.stFacetService.update(t.TermPropertyName,this.group))},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"typeterm",{get:function(){return this._typeterm},set:function(e){this._typeterm=e,this.stFacetService.updateTypeGroup(t.TermPropertyName,this.group)},enumerable:!0,configurable:!0}),e.prototype.notify=function(){this.results=null,this.id=null,this.term=this.model},e.prototype.notifyUrl=function(t){var e=this;setTimeout(function(){e.typeterm=e.model,e.typeterm?e.redirect(t,e.typeterm,null):e.redirect(t,null,null)},1e3)},e.prototype.changed=function(){this.model&&this.model.length>=3?(this.id=null,this.typeterm=this.model):this.results=null},e.prototype.blurred=function(){var t=this;setTimeout(function(){t.typeterm=null,t.showResults=!1},200)},e.prototype.search=function(t){console.log(t),this.results=null,"-1"===t?this.term=this.typeterm:(this.id=t,this.term=this.typeterm)},e.prototype.searchUrl=function(t,e){this.typeterm?this.redirect(t,this.typeterm,e):this.redirect(t,null,e)},e.prototype.redirect=function(t,e,r){var o=t+"#/?";e&&(o+="term="+e),r&&(e&&(o+="&"),o+="id="+r),window.location.href=o},e.$inject=["$rootScope","stFacetService"],e}();angular.module("st.search").controller("stTermTypeAheadCtrl",e)}(e=t.search||(t.search={}))}(st||(st={})),function(t){var e;!function(t){var e=function(){function e(e,r){var o=this;this.facetService=r,this.group=t.DefaultGroup,this.pages=[],e.$on("stRegisterFacets",function(t){o.facetService.registerFacets(o.group)}),e.$on("stFacetsInit",function(t,e,r){var s=o.facetService.getPageId(o.group),i=o.selectPageId(s,!1);i&&r.push(o.group)}),e.$on("stSearchResponse",function(t,e,r){if(!angular.isUndefined(r)&&r===o.group)if(Array.isArray(e)?e.length&&(o.results=e[e.length-1]):o.results=e,o.results){o.pages.length=o.results.Pages;for(var s=0;s<o.results.Pages;s++)o.pages[s]?o.pages[s].isActive=s===o.results.Page-1:o.pages[s]={id:s+1,isActive:s===o.results.Page-1}}else o.pages.length=0})}return Object.defineProperty(e.prototype,"isSearching",{get:function(){return this.facetService.isSearching[this.group]},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"isTypeAhead",{get:function(){return this.facetService.isTypeAhead[this.group]},enumerable:!0,configurable:!0}),e.prototype.selectPage=function(t,e){return void 0===e&&(e=!0),this.selectPageId(t.id,e)},e.prototype.selectPageIndex=function(t,e){void 0===e&&(e=!0);var r;return!!(0<=t&&t<this.pages.length&&(r=this.pages[t]))&&this.selectPageId(r.id,e)},e.prototype.selectPageId=function(t,e){void 0===e&&(e=!0);var r=!1;return this.pages.forEach(function(e){e.id===t?e.isActive||(e.isActive=!0,r=!0):e.isActive&&(e.isActive=!1,r=!0)}),r&&e&&this.facetService.setPage(t,this.group),r},e.$inject=["$rootScope","stFacetService"],e}();angular.module("st.search").controller("stFacetSearchResultsCtrl",e)}(e=t.search||(t.search={}))}(st||(st={}));