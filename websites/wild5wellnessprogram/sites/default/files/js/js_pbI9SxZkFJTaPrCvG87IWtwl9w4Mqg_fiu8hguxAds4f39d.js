/* @license GPL-2.0-or-later https://www.drupal.org/licensing/faq */
const OtsukaFM = Object.create({

  stack: [],
  cache: [],
  selectors: [],

  createFocusTrap: function (selector, options = { trapStack: this.stack, initialFocus: false, allowOutsideClick: true, escapeDeactivates: true }) {
    let trap = focusTrap.createFocusTrap(selector, options);

    trap.selector = selector;
    return trap;
  },

  addFocusTrap: function (selector) {
    let focusTrap = this.getFocusTrap(selector);
    if (!focusTrap) {
      focusTrap = this.createFocusTrap(selector);
    }
    return focusTrap;
  },

  getFocusTrap: function (selector = false) {
    if (selector) {
      return this.stack.find(e => e.selector === selector) ? this.stack.find(e => e.selector === selector) : false;
    }
    return this.stack[this.stack.length - 1] ? this.stack[this.stack.length - 1] : false;
  },

  deleteFocusTrap: function (selector = false) {
    if (selector) {
      this.stack = this.stack.filter(e => e.selector !== selector);
    } else {
      let last = this.stack.pop();
      return last ? last : false;
    }
  },

  activateFocusTrap: function (focusTrapObj) {
    try {
      focusTrapObj.activate();
    } catch (e) {
      // throw e
    }
  },

  deactivateFocusTrap: function (focusTrapObj) {
    try {
      focusTrapObj.deactivate();
    } catch (e) {
      // throw e
    }
  },

  trapFocus: function (selector) {
    let trap = this.addFocusTrap(selector);
    if (trap) {
      this.activateFocusTrap(trap);
    }
  },

  releaseFocus: function (selector) {
    let trap = this.getFocusTrap(selector);
    if (trap) {
      this.deactivateFocusTrap(trap);
      this.deleteFocusTrap(selector);
    }
    trap = this.getFocusTrap();
    if (trap) {
      this.activateFocusTrap(trap);
    }
  },

  cacheFocus: function() {
    if (this.cache.length) {
      return;
    }
    this.cache = [];
    this.stack.forEach((element) => {
      this.cache.push(element.selector);
    });
    this.cache.forEach((element) => {
      this.releaseFocus(element);
    });
  },

  restoreFocus: function() {
    this.cache.forEach((element) => {
      this.trapFocus(element);
    });
    this.cache = [];
  },

  waitForElement: function waitForElm(selector) {
    OtsukaFM.selectors.push(selector);
    return new Promise(function (resolve) {
      const initNode = document.querySelector(selector)
      if (initNode && initNode.checkVisibility()) {
        OtsukaFM.trapFocus(selector);
      }

      const observer = new MutationObserver(function (mutations) {
        mutations.forEach((mutation) => {
          if (mutation.type === 'attributes') {
            if (mutation.target.matches(selector)) {
              if (mutation.target.checkVisibility()) {
                OtsukaFM.trapFocus(selector);
              } else {
                OtsukaFM.releaseFocus(selector);
              }
            }
          } else if (mutation.type === 'childList') {
            mutation.addedNodes.forEach((node) => {
              if (node.nodeType === 1 && node.matches(selector)) {
                OtsukaFM.trapFocus(selector);
              }
            })
            mutation.removedNodes.forEach((node) => {
              if (node.nodeType === 1 && node.matches(selector)) {
                OtsukaFM.releaseFocus(selector);
              }
            })
          }
        })
      });

      observer.observe(document.body, {
        childList: true,
        subtree: true,
        attributes: true
      });
    });
  },

  cacheFocusOnElem: function (selector) {
    return new Promise(function (resolve) {
      const observer = new MutationObserver(function (mutations) {
        mutations.forEach((mutation) => {
          if (mutation.type === 'attributes') {
            if (mutation.target.matches(selector)) {
              if (mutation.target.checkVisibility()) {
                OtsukaFM.cacheFocus();
              } else {
                OtsukaFM.restoreFocus();
              }
            }
          } else if (mutation.type === 'childList') {
            mutation.addedNodes.forEach((node) => {
              if (node.nodeType === 1 && node.matches(selector)) {
                OtsukaFM.cacheFocus();
              }
            })
            mutation.removedNodes.forEach((node) => {
              if (node.nodeType === 1 && node.matches(selector)) {
                OtsukaFM.restoreFocus();
              }
            })
          }
        })
      });

      observer.observe(document.body, {
        childList: true,
        subtree: true,
        attributes: true
      });
    });
  },
});
;
(function($,Drupal,{tabbable,isTabbable}){function TabbingManager(){this.stack=[];}function TabbingContext(options){$.extend(this,{level:null,$tabbableElements:$(),$disabledElements:$(),released:false,active:false,trapFocus:false},options);}$.extend(TabbingManager.prototype,{constrain(elements,{trapFocus=false}={}){const il=this.stack.length;for(let i=0;i<il;i++)this.stack[i].deactivate();let tabbableElements=[];$(elements).each((index,rootElement)=>{tabbableElements=[...tabbableElements,...tabbable(rootElement)];if(isTabbable(rootElement))tabbableElements=[...tabbableElements,rootElement];});const tabbingContext=new TabbingContext({level:this.stack.length,$tabbableElements:$(tabbableElements),trapFocus});this.stack.push(tabbingContext);tabbingContext.activate();$(document).trigger('drupalTabbingConstrained',tabbingContext);return tabbingContext;},release(){let toActivate=this.stack.length-1;while(toActivate>=0&&this.stack[toActivate].released)toActivate--;this.stack.splice(toActivate+1);if(toActivate>=0)this.stack[toActivate].activate();},activate(tabbingContext){const $set=tabbingContext.$tabbableElements;const level=tabbingContext.level;const $disabledSet=$(tabbable(document.body)).not($set);tabbingContext.$disabledElements=$disabledSet;const il=$disabledSet.length;for(let i=0;i<il;i++)this.recordTabindex($disabledSet.eq(i),level);$disabledSet.prop('tabindex',-1).prop('autofocus',false);let $hasFocus=$set.filter('[autofocus]').eq(-1);if($hasFocus.length===0)$hasFocus=$set.eq(0);$hasFocus.trigger('focus');if($set.length&&tabbingContext.trapFocus){$set.last().on('keydown.focus-trap',(event)=>{if(event.key==='Tab'&&!event.shiftKey){event.preventDefault();$set.first().focus();}});$set.first().on('keydown.focus-trap',(event)=>{if(event.key==='Tab'&&event.shiftKey){event.preventDefault();$set.last().focus();}});}},deactivate(tabbingContext){const $set=tabbingContext.$disabledElements;const level=tabbingContext.level;const il=$set.length;tabbingContext.$tabbableElements.first().off('keydown.focus-trap');tabbingContext.$tabbableElements.last().off('keydown.focus-trap');for(let i=0;i<il;i++)this.restoreTabindex($set.eq(i),level);},recordTabindex($el,level){const tabInfo=$el.data('drupalOriginalTabIndices')||{};tabInfo[level]={tabindex:$el[0].getAttribute('tabindex'),autofocus:$el[0].hasAttribute('autofocus')};$el.data('drupalOriginalTabIndices',tabInfo);},restoreTabindex($el,level){const tabInfo=$el.data('drupalOriginalTabIndices');if(tabInfo&&tabInfo[level]){const data=tabInfo[level];if(data.tabindex)$el[0].setAttribute('tabindex',data.tabindex);else $el[0].removeAttribute('tabindex');if(data.autofocus)$el[0].setAttribute('autofocus','autofocus');if(level===0)$el.removeData('drupalOriginalTabIndices');else{let levelToDelete=level;while(tabInfo.hasOwnProperty(levelToDelete)){delete tabInfo[levelToDelete];levelToDelete++;}$el.data('drupalOriginalTabIndices',tabInfo);}}}});$.extend(TabbingContext.prototype,{release(){if(!this.released){this.deactivate();this.released=true;Drupal.tabbingManager.release(this);$(document).trigger('drupalTabbingContextReleased',this);}},activate(){if(!this.active&&!this.released){this.active=true;Drupal.tabbingManager.activate(this);$(document).trigger('drupalTabbingContextActivated',this);}},deactivate(){if(this.active){this.active=false;Drupal.tabbingManager.deactivate(this);$(document).trigger('drupalTabbingContextDeactivated',this);}}});if(Drupal.tabbingManager)return;Drupal.tabbingManager=new TabbingManager();})(jQuery,Drupal,window.tabbable);;
Drupal.debounce=function(func,wait,immediate){let timeout;let result;return function(...args){const context=this;const later=function(){timeout=null;if(!immediate)result=func.apply(context,args);};const callNow=immediate&&!timeout;clearTimeout(timeout);timeout=setTimeout(later,wait);if(callNow)result=func.apply(context,args);return result;};};;
(function(Drupal,debounce){let liveElement;const announcements=[];Drupal.behaviors.drupalAnnounce={attach(context){if(!liveElement){liveElement=document.createElement('div');liveElement.id='drupal-live-announce';liveElement.className='visually-hidden';liveElement.setAttribute('aria-live','polite');liveElement.setAttribute('aria-busy','false');document.body.appendChild(liveElement);}}};function announce(){const text=[];let priority='polite';let announcement;const il=announcements.length;for(let i=0;i<il;i++){announcement=announcements.pop();text.unshift(announcement.text);if(announcement.priority==='assertive')priority='assertive';}if(text.length){liveElement.innerHTML='';liveElement.setAttribute('aria-busy','true');liveElement.setAttribute('aria-live',priority);liveElement.innerHTML=text.join('\n');liveElement.setAttribute('aria-busy','false');}}Drupal.announce=function(text,priority){announcements.push({text,priority});return debounce(announce,200)();};})(Drupal,Drupal.debounce);;
(function($,Drupal,debounce){const cache={right:0,left:0,bottom:0,top:0};const cssVarPrefix='--drupal-displace-offset';const documentStyle=document.documentElement.style;const offsetKeys=Object.keys(cache);const offsetProps={};offsetKeys.forEach((edge)=>{offsetProps[edge]={enumerable:true,get(){return cache[edge];},set(value){if(value!==cache[edge])documentStyle.setProperty(`${cssVarPrefix}-${edge}`,`${value}px`);cache[edge]=value;}};});const offsets=Object.seal(Object.defineProperties({},offsetProps));function getRawOffset(el,edge){const $el=$(el);const documentElement=document.documentElement;let displacement=0;const horizontal=edge==='left'||edge==='right';let placement=$el.offset()[horizontal?'left':'top'];placement-=window[`scroll${horizontal?'X':'Y'}`]||document.documentElement[`scroll${horizontal?'Left':'Top'}`]||0;switch(edge){case 'top':displacement=placement+$el.outerHeight();break;case 'left':displacement=placement+$el.outerWidth();break;case 'bottom':displacement=documentElement.clientHeight-placement;break;case 'right':displacement=documentElement.clientWidth-placement;break;default:displacement=0;}return displacement;}function calculateOffset(edge){let edgeOffset=0;const displacingElements=document.querySelectorAll(`[data-offset-${edge}]`);const n=displacingElements.length;for(let i=0;i<n;i++){const el=displacingElements[i];if(el.style.display==='none')continue;let displacement=parseInt(el.getAttribute(`data-offset-${edge}`),10);if(isNaN(displacement))displacement=getRawOffset(el,edge);edgeOffset=Math.max(edgeOffset,displacement);}return edgeOffset;}function displace(broadcast=true){const newOffsets={};offsetKeys.forEach((edge)=>{newOffsets[edge]=calculateOffset(edge);});offsetKeys.forEach((edge)=>{offsets[edge]=newOffsets[edge];});if(broadcast)$(document).trigger('drupalViewportOffsetChange',offsets);return offsets;}Drupal.behaviors.drupalDisplace={attach(){if(this.displaceProcessed)return;this.displaceProcessed=true;$(window).on('resize.drupalDisplace',debounce(displace,200));}};Drupal.displace=displace;Object.defineProperty(Drupal.displace,'offsets',{value:offsets,writable:false});Drupal.displace.calculateOffset=calculateOffset;})(jQuery,Drupal,Drupal.debounce);;
(($,Drupal,{isTabbable})=>{$.extend($.expr[':'],{tabbable(element){Drupal.deprecationError({message:'The :tabbable selector is deprecated in Drupal 9.2.0 and will be removed in Drupal 11.0.0. Use the core/tabbable library instead. See https://www.drupal.org/node/3183730'});return isTabbable(element);}});})(jQuery,Drupal,window.tabbable);;
(($)=>{let cachedScrollbarWidth=null;const {max,abs}=Math;const regexHorizontal=/left|center|right/;const regexVertical=/top|center|bottom/;const regexOffset=/[+-]\d+(\.[\d]+)?%?/;const regexPosition=/^\w+/;const _position=$.fn.position;function getOffsets(offsets,width,height){return [parseFloat(offsets[0])*(typeof offsets[0]==='string'&&offsets[0].endsWith('%')?width/100:1),parseFloat(offsets[1])*(typeof offsets[1]==='string'&&offsets[1].endsWith('%')?height/100:1)];}function parseCss(element,property){return parseInt(window.getComputedStyle(element)[property],10)||0;}function getDimensions(elem){const raw=elem[0];if(raw.nodeType===9)return {width:elem.width(),height:elem.height(),offset:{top:0,left:0}};if(!!raw&&raw===raw.window)return {width:elem.width(),height:elem.height(),offset:{top:elem.scrollTop(),left:elem.scrollLeft()}};if(raw.preventDefault)return {width:0,height:0,offset:{top:raw.pageY,left:raw.pageX}};return {width:elem.outerWidth(),height:elem.outerHeight(),offset:elem.offset()};}const collisions={fit:{left(position,data){const {within}=data;const withinOffset=within.isWindow?within.scrollLeft:within.offset.left;const outerWidth=within.width;const collisionPosLeft=position.left-data.collisionPosition.marginLeft;const overLeft=withinOffset-collisionPosLeft;const overRight=collisionPosLeft+data.collisionWidth-outerWidth-withinOffset;let newOverRight;if(data.collisionWidth>outerWidth)if(overLeft>0&&overRight<=0){newOverRight=position.left+overLeft+data.collisionWidth-outerWidth-withinOffset;position.left+=overLeft-newOverRight;}else if(overRight>0&&overLeft<=0)position.left=withinOffset;else if(overLeft>overRight)position.left=withinOffset+outerWidth-data.collisionWidth;else position.left=withinOffset;else if(overLeft>0)position.left+=overLeft;else if(overRight>0)position.left-=overRight;else position.left=max(position.left-collisionPosLeft,position.left);},top(position,data){const {within}=data;const withinOffset=within.isWindow?within.scrollTop:within.offset.top;const outerHeight=data.within.height;const collisionPosTop=position.top-data.collisionPosition.marginTop;const overTop=withinOffset-collisionPosTop;const overBottom=collisionPosTop+data.collisionHeight-outerHeight-withinOffset;let newOverBottom;if(data.collisionHeight>outerHeight)if(overTop>0&&overBottom<=0){newOverBottom=position.top+overTop+data.collisionHeight-outerHeight-withinOffset;position.top+=overTop-newOverBottom;}else if(overBottom>0&&overTop<=0)position.top=withinOffset;else if(overTop>overBottom)position.top=withinOffset+outerHeight-data.collisionHeight;else position.top=withinOffset;else if(overTop>0)position.top+=overTop;else if(overBottom>0)position.top-=overBottom;else position.top=max(position.top-collisionPosTop,position.top);}},flip:{left(position,data){const {within}=data;const withinOffset=within.offset.left+within.scrollLeft;const outerWidth=within.width;const offsetLeft=within.isWindow?within.scrollLeft:within.offset.left;const collisionPosLeft=position.left-data.collisionPosition.marginLeft;const overLeft=collisionPosLeft-offsetLeft;const overRight=collisionPosLeft+data.collisionWidth-outerWidth-offsetLeft;const myOffset=data.my[0]==='left'?-data.elemWidth:data.my[0]==='right'?data.elemWidth:0;const atOffset=data.at[0]==='left'?data.targetWidth:data.at[0]==='right'?-data.targetWidth:0;const offset=-2*data.offset[0];let newOverRight;let newOverLeft;if(overLeft<0){newOverRight=position.left+myOffset+atOffset+offset+data.collisionWidth-outerWidth-withinOffset;if(newOverRight<0||newOverRight<abs(overLeft))position.left+=myOffset+atOffset+offset;}else{if(overRight>0){newOverLeft=position.left-data.collisionPosition.marginLeft+myOffset+atOffset+offset-offsetLeft;if(newOverLeft>0||abs(newOverLeft)<overRight)position.left+=myOffset+atOffset+offset;}}},top(position,data){const {within}=data;const withinOffset=within.offset.top+within.scrollTop;const outerHeight=within.height;const offsetTop=within.isWindow?within.scrollTop:within.offset.top;const collisionPosTop=position.top-data.collisionPosition.marginTop;const overTop=collisionPosTop-offsetTop;const overBottom=collisionPosTop+data.collisionHeight-outerHeight-offsetTop;const top=data.my[1]==='top';const myOffset=top?-data.elemHeight:data.my[1]==='bottom'?data.elemHeight:0;const atOffset=data.at[1]==='top'?data.targetHeight:data.at[1]==='bottom'?-data.targetHeight:0;const offset=-2*data.offset[1];let newOverTop;let newOverBottom;if(overTop<0){newOverBottom=position.top+myOffset+atOffset+offset+data.collisionHeight-outerHeight-withinOffset;if(newOverBottom<0||newOverBottom<abs(overTop))position.top+=myOffset+atOffset+offset;}else{if(overBottom>0){newOverTop=position.top-data.collisionPosition.marginTop+myOffset+atOffset+offset-offsetTop;if(newOverTop>0||abs(newOverTop)<overBottom)position.top+=myOffset+atOffset+offset;}}}},flipfit:{left(...args){collisions.flip.left.apply(this,args);collisions.fit.left.apply(this,args);},top(...args){collisions.flip.top.apply(this,args);collisions.fit.top.apply(this,args);}}};$.position={scrollbarWidth(){if(cachedScrollbarWidth!==undefined)return cachedScrollbarWidth;const div=$('<div '+"style='display:block;position:absolute;width:50px;height:50px;overflow:hidden;'>"+"<div style='height:100px;width:auto;'></div></div>");const innerDiv=div.children()[0];$('body').append(div);const w1=innerDiv.offsetWidth;div[0].style.overflow='scroll';let w2=innerDiv.offsetWidth;if(w1===w2)w2=div[0].clientWidth;div.remove();cachedScrollbarWidth=w1-w2;return cachedScrollbarWidth;},getScrollInfo(within){const overflowX=within.isWindow||within.isDocument?'':window.getComputedStyle(within.element[0])['overflow-x'];const overflowY=within.isWindow||within.isDocument?'':window.getComputedStyle(within.element[0])['overflow-y'];const hasOverflowX=overflowX==='scroll'||(overflowX==='auto'&&within.width<within.element[0].scrollWidth);const hasOverflowY=overflowY==='scroll'||(overflowY==='auto'&&within.height<within.element[0].scrollHeight);return {width:hasOverflowY?$.position.scrollbarWidth():0,height:hasOverflowX?$.position.scrollbarWidth():0};},getWithinInfo(element){const withinElement=$(element||window);const isWindow=!!withinElement[0]&&withinElement[0]===withinElement[0].window;const isDocument=!!withinElement[0]&&withinElement[0].nodeType===9;const hasOffset=!isWindow&&!isDocument;return {element:withinElement,isWindow,isDocument,offset:hasOffset?$(element).offset():{left:0,top:0},scrollLeft:withinElement.scrollLeft(),scrollTop:withinElement.scrollTop(),width:withinElement.outerWidth(),height:withinElement.outerHeight()};}};$.fn.position=function(options){if(!options||!options.of)return _position.apply(this,arguments);options=$.extend({},options);const within=$.position.getWithinInfo(options.within);const scrollInfo=$.position.getScrollInfo(within);const collision=(options.collision||'flip').split(' ');const offsets={};const target=typeof options.of==='string'?$(document).find(options.of):$(options.of);const dimensions=getDimensions(target);const targetWidth=dimensions.width;const targetHeight=dimensions.height;const targetOffset=dimensions.offset;if(target[0].preventDefault)options.at='left top';const basePosition=$.extend({},targetOffset);$.each(['my','at'],function(){let pos=(options[this]||'').split(' ');if(pos.length===1)pos=regexHorizontal.test(pos[0])?pos.concat(['center']):regexVertical.test(pos[0])?['center'].concat(pos):['center','center'];pos[0]=regexHorizontal.test(pos[0])?pos[0]:'center';pos[1]=regexVertical.test(pos[1])?pos[1]:'center';const horizontalOffset=regexOffset.exec(pos[0]);const verticalOffset=regexOffset.exec(pos[1]);offsets[this]=[horizontalOffset?horizontalOffset[0]:0,verticalOffset?verticalOffset[0]:0];options[this]=[regexPosition.exec(pos[0])[0],regexPosition.exec(pos[1])[0]];});if(collision.length===1)collision[1]=collision[0];if(options.at[0]==='right')basePosition.left+=targetWidth;else{if(options.at[0]==='center')basePosition.left+=targetWidth/2;}if(options.at[1]==='bottom')basePosition.top+=targetHeight;else{if(options.at[1]==='center')basePosition.top+=targetHeight/2;}const atOffset=getOffsets(offsets.at,targetWidth,targetHeight);basePosition.left+=atOffset[0];basePosition.top+=atOffset[1];return this.each(function(){let using;const elem=$(this);const elemWidth=elem.outerWidth();const elemHeight=elem.outerHeight();const marginLeft=parseCss(this,'marginLeft');const marginTop=parseCss(this,'marginTop');const collisionWidth=elemWidth+marginLeft+parseCss(this,'marginRight')+scrollInfo.width;const collisionHeight=elemHeight+marginTop+parseCss(this,'marginBottom')+scrollInfo.height;const position=$.extend({},basePosition);const myOffset=getOffsets(offsets.my,elem.outerWidth(),elem.outerHeight());if(options.my[0]==='right')position.left-=elemWidth;else{if(options.my[0]==='center')position.left-=elemWidth/2;}if(options.my[1]==='bottom')position.top-=elemHeight;else{if(options.my[1]==='center')position.top-=elemHeight/2;}position.left+=myOffset[0];position.top+=myOffset[1];const collisionPosition={marginLeft,marginTop};$.each(['left','top'],function(i,dir){if(collisions[collision[i]])collisions[collision[i]][dir](position,{targetWidth,targetHeight,elemWidth,elemHeight,collisionPosition,collisionWidth,collisionHeight,offset:[atOffset[0]+myOffset[0],atOffset[1]+myOffset[1]],my:options.my,at:options.at,within,elem});});if(options.using)using=function(props){const left=targetOffset.left-position.left;const right=left+targetWidth-elemWidth;const top=targetOffset.top-position.top;const bottom=top+targetHeight-elemHeight;const feedback={target:{element:target,left:targetOffset.left,top:targetOffset.top,width:targetWidth,height:targetHeight},element:{element:elem,left:position.left,top:position.top,width:elemWidth,height:elemHeight},horizontal:right<0?'left':left>0?'right':'center',vertical:bottom<0?'top':top>0?'bottom':'middle'};if(targetWidth<elemWidth&&abs(left+right)<targetWidth)feedback.horizontal='center';if(targetHeight<elemHeight&&abs(top+bottom)<targetHeight)feedback.vertical='middle';if(max(abs(left),abs(right))>max(abs(top),abs(bottom)))feedback.important='horizontal';else feedback.important='vertical';options.using.call(this,props,feedback);};elem.offset($.extend(position,{using}));});};if(!$.hasOwnProperty('ui'))$.ui={};$.ui.position=collisions;})(jQuery);;
(function($,Drupal,once){if(once('drupal-dialog-deprecation-listener','html').length){const eventSpecial={handle($event){const $element=$($event.target);const event=$event.originalEvent;const dialog=event.dialog;const dialogArguments=[$event,dialog,$element,event?.settings];$event.handleObj.handler.apply(this,dialogArguments);}};$.event.special['dialog:beforecreate']=eventSpecial;$.event.special['dialog:aftercreate']=eventSpecial;$.event.special['dialog:beforeclose']=eventSpecial;$.event.special['dialog:afterclose']=eventSpecial;const listenDialogEvent=(event)=>{const windowEvents=$._data(window,'events');const isWindowHasDialogListener=windowEvents[event.type];if(isWindowHasDialogListener)Drupal.deprecationError({message:`jQuery event ${event.type} is deprecated in 10.3.0 and is removed from Drupal:12.0.0. See https://www.drupal.org/node/3422670`});};['dialog:beforecreate','dialog:aftercreate','dialog:beforeclose','dialog:afterclose'].forEach((e)=>window.addEventListener(e,listenDialogEvent));}})(jQuery,Drupal,once);;
class DrupalDialogEvent extends Event{constructor(type,dialog,settings=null){super(`dialog:${type}`,{bubbles:true});this.dialog=dialog;this.settings=settings;}}(function($,Drupal,drupalSettings,bodyScrollLock){drupalSettings.dialog={autoOpen:true,dialogClass:'',buttonClass:'button',buttonPrimaryClass:'button--primary',close(event){Drupal.dialog(event.target).close();Drupal.detachBehaviors(event.target,null,'unload');}};Drupal.dialog=function(element,options){let undef;const $element=$(element);const domElement=$element.get(0);const dialog={open:false,returnValue:undef};function openDialog(settings){settings=$.extend({},drupalSettings.dialog,options,settings);const event=new DrupalDialogEvent('beforecreate',dialog,settings);domElement.dispatchEvent(event);$element.dialog(event.settings);dialog.open=true;if(event.settings.modal)bodyScrollLock.lock(domElement);domElement.dispatchEvent(new DrupalDialogEvent('aftercreate',dialog,event.settings));}function closeDialog(value){domElement.dispatchEvent(new DrupalDialogEvent('beforeclose',dialog));bodyScrollLock.clearBodyLocks();$element.dialog('close');dialog.returnValue=value;dialog.open=false;domElement.dispatchEvent(new DrupalDialogEvent('afterclose',dialog));}dialog.show=()=>{openDialog({modal:false});};dialog.showModal=()=>{openDialog({modal:true});};dialog.close=closeDialog;return dialog;};})(jQuery,Drupal,drupalSettings,bodyScrollLock);;
(function($,Drupal,drupalSettings,debounce,displace){drupalSettings.dialog=$.extend({autoResize:true,maxHeight:'95%'},drupalSettings.dialog);function resetPosition(options){const offsets=displace.offsets;const left=offsets.left-offsets.right;const top=offsets.top-offsets.bottom;const leftString=`${(left>0?'+':'-')+Math.abs(Math.round(left/2))}px`;const topString=`${(top>0?'+':'-')+Math.abs(Math.round(top/2))}px`;options.position={my:`center${left!==0?leftString:''} center${top!==0?topString:''}`,of:window};return options;}function resetSize(event){const positionOptions=['width','height','minWidth','minHeight','maxHeight','maxWidth','position'];let adjustedOptions={};let windowHeight=$(window).height();let option;let optionValue;let adjustedValue;for(let n=0;n<positionOptions.length;n++){option=positionOptions[n];optionValue=event.data.settings[option];if(optionValue)if(typeof optionValue==='string'&&optionValue.endsWith('%')&&/height/i.test(option)){windowHeight-=displace.offsets.top+displace.offsets.bottom;adjustedValue=parseInt(0.01*parseInt(optionValue,10)*windowHeight,10);if(option==='height'&&Math.round(event.data.$element.parent().outerHeight())<adjustedValue)adjustedValue='auto';adjustedOptions[option]=adjustedValue;}}if(!event.data.settings.modal)adjustedOptions=resetPosition(adjustedOptions);event.data.$element.dialog('option',adjustedOptions);event.data.$element?.get(0)?.dispatchEvent(new CustomEvent('dialogContentResize',{bubbles:true}));}window.addEventListener('dialog:aftercreate',(e)=>{const autoResize=debounce(resetSize,20);const $element=$(e.target);const {settings}=e;const eventData={settings,$element};if(settings.autoResize===true||settings.autoResize==='true'){const uiDialog=$element.dialog('option',{resizable:false,draggable:false}).dialog('widget');uiDialog[0].style.position='fixed';$(window).on('resize.dialogResize scroll.dialogResize',eventData,autoResize).trigger('resize.dialogResize');$(document).on('drupalViewportOffsetChange.dialogResize',eventData,autoResize);}});window.addEventListener('dialog:beforeclose',()=>{$(window).off('.dialogResize');$(document).off('.dialogResize');});})(jQuery,Drupal,drupalSettings,Drupal.debounce,Drupal.displace);;
(function($,{tabbable,isTabbable}){$.widget('ui.dialog',$.ui.dialog,{options:{buttonClass:'button',buttonPrimaryClass:'button--primary'},_createButtons(){const opts=this.options;let primaryIndex;let index;const il=opts.buttons.length;for(index=0;index<il;index++)if(opts.buttons[index].primary&&opts.buttons[index].primary===true){primaryIndex=index;delete opts.buttons[index].primary;break;}this._super();const $buttons=this.uiButtonSet.children().addClass(opts.buttonClass);if(typeof primaryIndex!=='undefined')$buttons.eq(index).addClass(opts.buttonPrimaryClass);},_focusTabbable(){let hasFocus=this._focusedElement?this._focusedElement.get(0):null;if(!hasFocus)hasFocus=this.element.find('[autofocus]').get(0);if(!hasFocus){const $elements=[this.element,this.uiDialogButtonPane];for(let i=0;i<$elements.length;i++){const element=$elements[i].get(0);if(element){const elementTabbable=tabbable(element);hasFocus=elementTabbable.length?elementTabbable[0]:null;}if(hasFocus)break;}}if(!hasFocus){const closeBtn=this.uiDialogTitlebarClose.get(0);hasFocus=closeBtn&&isTabbable(closeBtn)?closeBtn:null;}if(!hasFocus)hasFocus=this.uiDialog.get(0);$(hasFocus).eq(0).trigger('focus');}});})(jQuery,window.tabbable);;
(($)=>{$.widget('ui.dialog',$.ui.dialog,{_allowInteraction(event){if(event.target.classList===undefined)return this._super(event);return event.target.classList.contains('ck')||this._super(event);}});})(jQuery);;
const OtsukaPCM=Object.create({cmpPlatform:"onetrust",providers:{VIMEO:"vimeo",YOUTUBE:"youtube",BUZZSPROUT:"buzzsprout",ORBITA:"orbita"},settings:drupalSettings.privacy_compliant_media_settings,getProviderSettings:function(provider){switch(provider){case this.providers.VIMEO:return this.settings.vimeo;case this.providers.YOUTUBE:return this.settings.youtube;case this.providers.BUZZSPROUT:return this.settings.buzzsprout_podcasts;case this.providers.ORBITA:return this.settings.orbita_live_chat;default:return null;}},overlayImageClassname:"otsuka-pcm-img-overlay",videoThumbnailClassname:"otsuka-pcm-video-thumbnail",thumbnailOverlayClassname:"otsuka-pcm-img-overlay__transparent",thumbnailOverlayDefaultClassname:"with-default-video-overlay",thumbnailOverlayCustomClassname:"with-custom-video-overlay",buzzsproutPlaceholderDefaultClassname:"with-default-buzzsprout-placeholder",buzzsproutPlaceholderCustomClassname:"with-custom-buzzsprout-placeholder",overlayClassname:"otsuka-pcm-consent-overlay",modalClassname:"otsuka-pcm-consent-modal",printError:function(message){console.error(this.formatErrorMessage(message));},throwError:function(message){throw new Error(this.formatErrorMessage(message));},formatErrorMessage:function(message){return `OtsukaPCM: ${message}`;},createElementFromText:function(text,tagName="div",strip=true){let element=document.createElement(tagName);element.innerHTML=text??"";return strip?element.firstChild:element;},awaitOneTrust:function(){return new Promise(function(resolve,reject){if(typeof OneTrust==="object")resolve(OneTrust);let attempt=0;const maxAttempts=50;const interval=setInterval(()=>{if(typeof OneTrust==="object"){clearInterval(interval);resolve(OneTrust);}attempt++;if(attempt>=maxAttempts){clearInterval(interval);reject(OtsukaPCM.formatErrorMessage("awaitOneTrust: OneTrust not found within allotted time"));}},100);});},awaitCMP:function(){switch(this.cmpPlatform){case "onetrust":return this.awaitOneTrust();default:return Promise.reject();}},awaitOrbitaChatbot:function(){return new Promise(function(resolve,reject){if(typeof OrbitaChatBotV3==="object"&&Object.hasOwn(OrbitaChatBotV3,"botLoaded")&&OrbitaChatBotV3.botLoaded())resolve(OrbitaChatBotV3);let attempt=0;const maxAttempts=50;const interval=setInterval(()=>{if(typeof OrbitaChatBotV3==="object"&&Object.hasOwn(OrbitaChatBotV3,"botLoaded")&&OrbitaChatBotV3.botLoaded()){clearInterval(interval);resolve(OrbitaChatBotV3);}attempt++;if(attempt>=maxAttempts){clearInterval(interval);this.throwError("awaitOrbitaChatbot: Orbita Chatbot not found within allotted time");reject();}},100);});},awaitOrbitaChatButton:function(){return new Promise(function(resolve,reject){const orbitaButton=document.querySelector("button.chat-icon");if(orbitaButton)resolve(orbitaButton);let attempt=0;const maxAttempts=50;const interval=setInterval(()=>{const orbitaButton=document.querySelector("button.chat-icon");if(orbitaButton){clearInterval(interval);resolve(orbitaButton);}attempt++;if(attempt>=maxAttempts){clearInterval(interval);this.throwError("awaitOrbitaChatButton: Orbita chat button not found within allotted time");reject();}},100);});},isConsentedToCategoryOneTrust:async function(category_id){try{await this.awaitOneTrust();}catch(e){throw e;}return OnetrustActiveGroups?.split(",").includes(category_id);},isConsentedToCategory:async function(category_id){switch(this.cmpPlatform){case "onetrust":try{const isConsented=await this.isConsentedToCategoryOneTrust(category_id);return isConsented;}catch(e){throw e;}default:return false;}},consentToCategoryOneTrust:async function(category_id){try{await this.awaitOneTrust();}catch(e){this.throwError("consentToCategoryOneTrust: Error consenting to OneTrust category");return false;}OneTrust.UpdateConsent("Category",`${category_id}:1`);return true;},consentToCategory:async function(category_id){let result=false;switch(this.cmpPlatform){case "onetrust":result=await this.consentToCategoryOneTrust(category_id);break;}return result;},insertScript:function(script){script.src=script.getAttribute("data-src");},insertScriptIfConsented:async function({url,selector,callback=null,options=null,categoryId,async=false}){try{await this.awaitOneTrust();}catch(e){this.throwError("insertScriptIfConsented: Error inserting script");return false;}OneTrust.InsertScript(url,selector,callback,options,categoryId,async);},getConsentCategoryForProvider:function(provider){return this.getProviderSettings(provider)?.cat_id;},genUID:function(p){var c=0,i;p=typeof p==="string"?p:"";do i=p+c++;while(document.getElementById(i)!==null);return i;},hasQueryString:function(url){return url.indexOf("?")!=-1;},loadScript:function(src,id){return new Promise(function(resolve,reject){if(document.getElementById(id))resolve();else{const script=document.createElement("script");script.onload=resolve;script.id=id;script.src=src;const firstScriptTag=document.getElementsByTagName("script")[0];firstScriptTag.parentNode.insertBefore(script,firstScriptTag);}});},loadYouTubeAPI:function(){function apiExists(){return "undefined"!==typeof YT&&YT.loaded;}if(apiExists())return;const promises=[];promises.push(this.loadScript("https://www.youtube.com/iframe_api","youtube-api"));promises.push(new Promise(function(resolve,reject){const intervalId=setInterval(function(){if(apiExists()){clearInterval(intervalId);resolve();}},100);}));return Promise.all(promises);},loadVimeoAPI:function(){function apiExists(){return "undefined"!==typeof Vimeo;}if(apiExists())return;const promises=[];promises.push(this.loadScript("https://player.vimeo.com/api/player.js","vimeo-api"));promises.push(new Promise(function(resolve,reject){const intervalId=setInterval(function(){if(apiExists()){clearInterval(intervalId);resolve();}},100);}));return Promise.all(promises);},loadPlayerAPI:function(provider){switch(provider){case this.providers.VIMEO:return this.loadVimeoAPI();case this.providers.YOUTUBE:return this.loadYouTubeAPI();default:return Promise.resolve();}},playIframeVideo:function(iframe){const dataSrc=iframe.getAttribute("data-src");const {provider,video_id}=this.isManagedSrc(dataSrc);const matcher=/(\/media\/oembed\?url=)([^&]+)(.+)/;const isOembed=dataSrc.match(matcher);iframe.style.display="block";const dependent_cat_id=this.getProviderSettings(provider).dependent_cat_id;const privacy_enhanced=dependent_cat_id&&!this.isConsentedToCategory(dependent_cat_id);let iframeSrc=dataSrc;iframeSrc=iframeSrc.replace(/^https?:\/\//,'//');if(isOembed){if(privacy_enhanced)iframeSrc+=(this.hasQueryString(iframeSrc)?"&":"?")+"privacy_enhanced=1";iframe.src=iframeSrc;return;}switch(provider){case this.providers.VIMEO:{if(privacy_enhanced)iframeSrc+=(this.hasQueryString(iframeSrc)?"&":"?")+"dnt=1";iframe.src=iframeSrc;const player=new Vimeo.Player(iframe.id);player.play().then(function(){}).catch(function(e){switch(e.name){case "NotAllowedError":player.unload().then(function(){loadVideo(video_id);});break;}});break;}case this.providers.YOUTUBE:if(privacy_enhanced)iframeSrc=iframeSrc.replace(/(youtu\.be|youtube\.com)\//,"youtube-nocookie.com/");iframeSrc+=(this.hasQueryString(dataSrc)?"&":"?")+"enablejsapi=1";iframe.src=iframeSrc;new YT.Player(iframe.id,{events:{onReady:function(event){event.target.playVideo();}}});break;}iframe.querySelector(`video`)?.play();},isManagedSrc:function(src){let matcher=/(youtu\.be|youtube\.com|youtube-nocookie\.com)\/(embed\/|watch\?v=)?([^?&]+)/;let match=src?.match(matcher);if(match&&match[3])return {domain:match[1],video_id:match[3],provider:this.getProviderByDomain(match[1])};matcher=/(vimeo\.com)\/(video\/)?([0-9]+)/;match=src?.match(matcher);if(match&&match[3])return {domain:match[1],video_id:match[3],provider:this.getProviderByDomain(match[1])};matcher=/(buzzsprout\.com)\/([0-9]+)\.js/;match=src?.match(matcher);if(match&&match[2])return {domain:match[1],subscription_id:match[2],provider:this.getProviderByDomain(match[1])};matcher=/(orbita\.(cloud|com))(.*)\/chatbot\//;match=src?.match(matcher);if(match&&match[2])return {domain:match[1],provider:this.getProviderByDomain(match[1])};return false;},isManagedIframe:function(iframe){return iframe&&this.isManagedSrc(iframe.getAttribute("data-src"));},getProviderByIframe:function(iframe){const {provider}=this.isManagedIframe(iframe);return provider;},getProviderByDomain:function(domain){switch(domain){case "vimeo.com":return this.providers.VIMEO;case "youtube.com":case "youtu.be":case "youtube-nocookie.com":return this.providers.YOUTUBE;case "buzzsprout.com":return this.providers.BUZZSPROUT;case "orbita.com":case "orbita.cloud":return this.providers.ORBITA;}return false;},isProviderEnabled:function(provider){return this.getProviderSettings(provider)?.enabled||false;},getConsentOverlay:function(target){const id=target.getAttribute("id");return id?document.querySelector(`#${id} > .${this.overlayClassname}`):null;},removeConsentOverlay:function(target){this.getConsentOverlay(target)?.remove();},consentModalResizeObserver:new ResizeObserver((entries)=>{for(const entry of entries)if(entry.borderBoxSize[0].inlineSize>600)setTimeout(()=>entry.target.classList.add("wide"),0);else setTimeout(()=>entry.target.classList.remove("wide"),0);}),videoOverlayResizeObserver:new ResizeObserver((entries)=>{for(const entry of entries)if(entry.borderBoxSize[0].inlineSize>600)entry.target.classList.add("wide");else entry.target.classList.remove("wide");}),getConsentModal:function({target,provider,consentCallback=null,cancelCallback=null,withCloseButton=true}){const consent_category=this.getConsentCategoryForProvider(provider);const providerSettings=this.getProviderSettings(provider);const dialogTitleId=this.genUID("otsuka-pcm-dialogTitle-id-");const dialogDescId=this.genUID("otsuka-pcm-dialogDesc-id-");const modal=document.createElement("div");modal.setAttribute("role","dialog");modal.setAttribute("aria-labelledby",dialogTitleId);modal.setAttribute("aria-describedby",dialogDescId);modal.classList.add(this.modalClassname);modal.classList.add(provider);modal.addEventListener("click",function(e){e.stopPropagation();});let closeButton;if(withCloseButton){closeButton=document.createElement("div");closeButton.className="otsuka-pcm-consent-close";closeButton.innerHTML="&#10005;";closeButton.setAttribute("role","button");closeButton.setAttribute("aria-label","Close");closeButton.setAttribute("tabindex","0");closeButton.addEventListener("click",()=>{this.removeConsentOverlay(target);cancelCallback&&cancelCallback();});closeButton.addEventListener("keydown",(e)=>{if("Enter"===e.key)e.target.click();});}const dialogTitle=document.createElement("h2");dialogTitle.setAttribute("id",dialogTitleId);dialogTitle.setAttribute("hidden","hidden");dialogTitle.setAttribute("aria-hidden",true);dialogTitle.innerHTML="Consent request";const content=document.createElement("div");content.setAttribute("id",dialogDescId);content.className="otsuka-pcm-consent-content";content.innerHTML=providerSettings.modal.description;const consentButton=document.createElement("button");consentButton.className="otsuka-pcm-consent-button";consentButton.innerHTML=providerSettings.modal.consent_label;consentButton.addEventListener("click",async()=>{consentButton.setAttribute("disabled","");if(await this.consentToCategory(consent_category)){modal.parentNode.remove();consentCallback&&consentCallback();}consentButton.removeAttribute("disabled");});let moreLink;const moreLinkLabel=providerSettings.modal.morelink_label;const moreLinkUrl=providerSettings.modal.morelink_url;if(moreLinkLabel&&moreLinkUrl){moreLink=document.createElement("a");moreLink.className="otsuka-pcm-consent-link";moreLink.href=moreLinkUrl;moreLink.innerHTML=moreLinkLabel;moreLink.setAttribute("role","button");moreLink.setAttribute("aria-label",moreLinkLabel);}if(closeButton)modal.append(closeButton);modal.append(dialogTitle,content,consentButton);if(moreLink)modal.append(moreLink);this.consentModalResizeObserver.observe(modal);return modal;},getErrorModal:function({target,cancelCallback=null,withCloseButton=true}){const dialogTitleId=this.genUID("otsuka-pcm-dialogTitle-id-");const dialogDescId=this.genUID("otsuka-pcm-dialogDesc-id-");const modal=document.createElement("div");modal.setAttribute("role","dialog");modal.setAttribute("aria-labelledby",dialogTitleId);modal.setAttribute("aria-describedby",dialogDescId);modal.classList.add(this.modalClassname);modal.addEventListener("click",function(e){e.stopPropagation();});let closeButton;if(withCloseButton){closeButton=document.createElement("div");closeButton.className="otsuka-pcm-consent-close";closeButton.innerHTML="&#10005;";closeButton.setAttribute("role","button");closeButton.setAttribute("aria-label","Close");closeButton.addEventListener("click",()=>{this.removeConsentOverlay(target);cancelCallback&&cancelCallback();});}const dialogTitle=document.createElement("h2");dialogTitle.setAttribute("id",dialogTitleId);dialogTitle.setAttribute("hidden","hidden");dialogTitle.setAttribute("aria-hidden",true);dialogTitle.innerHTML="Error message";const content=document.createElement("div");content.setAttribute("id",dialogDescId);content.className="otsuka-pcm-error-content";content.innerHTML=this.settings.general.error_cmp_not_found;if(closeButton)modal.append(closeButton);modal.append(dialogTitle,content);this.consentModalResizeObserver.observe(modal);return modal;},createConsentOverlay:function({target,provider,consentCallback=null,cancelCallback=null,withCloseButton=true}){const overlay=document.createElement("div");overlay.classList.add(this.overlayClassname);overlay.addEventListener("click",function(e){e.stopPropagation();});const providerSettings=this.getProviderSettings(provider);if(providerSettings.modal.description!==''){const modal=this.getConsentModal({target,provider,consentCallback,cancelCallback,withCloseButton});overlay.append(modal);}return overlay;},createErrorOverlay:function({target,cancelCallback=null,withCloseButton=true}){const overlay=document.createElement("div");overlay.classList.add(this.overlayClassname);overlay.addEventListener("click",function(e){e.stopPropagation();});const modal=this.getErrorModal({target,cancelCallback,withCloseButton});overlay.append(modal);return overlay;},getVimeoThumbnailUrl:async function(video_id){try{const url=`https://vimeo.com/api/v2/video/${video_id}.json`;const response=await fetch(url);const data=await response.json();return data[0].thumbnail_large;}catch(error){}try{const url=`https://vimeo.com/api/oembed.json?url=https://player.vimeo.com/video/${video_id}&width=1970&width=1108`;const response=await fetch(url);const data=await response.json();return data.thumbnail_url;}catch(error){this.throwError("getVimeoThumbnailUrl: Error fetching Vimeo thumbnail: ",error);}return false;},getYoutubeThumbnailUrl:function(video_id){return `https://img.youtube.com/vi/${video_id}/maxresdefault.jpg`;},getThumbnailUrl:async function(provider,video_id){switch(provider){case this.providers.VIMEO:return await this.getVimeoThumbnailUrl(video_id);case this.providers.YOUTUBE:return this.getYoutubeThumbnailUrl(video_id);}return false;},getThumbnailImgForVideo:async function(provider,video_id){const img=document.createElement("img");img.classList.add(this.videoThumbnailClassname);img.src=await this.getThumbnailUrl(provider,video_id);return img;},getThumbnailImgForIframe:async function(iframe){const {video_id,provider}=this.isManagedIframe(iframe);return this.getThumbnailImgForVideo(provider,video_id);},getOverlayImageSrc:function(provider){return this.getProviderSettings(provider)?.overlay_image||false;},getOverlayImage:function(provider){const imgOverlaySrc=this.getOverlayImageSrc(provider);if(!imgOverlaySrc)return false;const imgOverlay=document.createElement("img");imgOverlay.src=imgOverlaySrc;imgOverlay.setAttribute("class",this.overlayImageClassname);return imgOverlay;},makeResponsiveIframe:function(iframe){iframe.parentNode.setAttribute("style","width:100%; height:0; position:relative; padding-bottom:56.25%");iframe.setAttribute("style","width:100%; height:100%; position:absolute; left:0; top:0");},doErrorModal:function({target,cancelCallback=null,withCloseButton=true}){const hasOverlay=this.getConsentOverlay(target);if(hasOverlay)return;if(!target.getAttribute("id")){const id=this.genUID("otsuka-pcm-overlay-id-");target.setAttribute("id",id);}const overlay=this.createErrorOverlay({target,cancelCallback,withCloseButton});target.append(overlay);},doConsentModal:async function({target,provider,consentCallback=null,cancelCallback=null,withCloseButton=true}){if(!this.isProviderEnabled(provider))try{this.doConsentCallback(consentCallback,provider,target);return;}catch(e){throw e;}const consent_category=this.getConsentCategoryForProvider(provider);const hasOverlay=this.getConsentOverlay(target);const providerSettings=this.getProviderSettings(provider);let isConsented=false;try{isConsented=await this.isConsentedToCategory(consent_category);}catch(e){throw e;}if(isConsented)try{this.doConsentCallback(consentCallback,provider,target);return;}catch(e){throw e;}else{if(hasOverlay)return;if(!target.getAttribute("id")){const id=this.genUID("otsuka-pcm-overlay-id-");target.setAttribute("id",id);}const overlayConsentCallback=()=>{this.doConsentCallback(consentCallback,provider,target);};const overlay=this.createConsentOverlay({target,provider,consentCallback:overlayConsentCallback,cancelCallback,withCloseButton});const previousOverlay=document.querySelector(".otsuka-pcm-consent-overlay");if(previousOverlay)previousOverlay.remove();if(providerSettings.modal.description!=='')target.append(overlay);const overlayClass=this.overlayClassname;let _this=this;_this.callback=consentCallback;_this.provider=provider;_this.target=target;OneTrust.OnConsentChanged(function(){let isConsentedPromise=OtsukaPCM.isConsentedToCategory(consent_category);isConsentedPromise.then((isConsentedResult)=>{const hasOverlay=OtsukaPCM.getConsentOverlay(_this.target);if(isConsentedResult&&hasOverlay)try{OtsukaPCM.doConsentCallback(_this.callback,_this.provider,_this.target);return;}catch(e){throw e;}});});if(typeof Drupal.behaviors.externalLinkPopup!==undefined)document.querySelectorAll('.otsuka-pcm-consent-overlay a').forEach((link)=>{if(link.classList.contains('external-link-popup-disabled'))return;if(!Drupal.behaviors.externalLinkPopup)return;const domain=Drupal.behaviors.externalLinkPopup.getDomain(link.getAttribute('href'));if(!domain)return;link.addEventListener('click',function(e){for(var i=0;i<drupalSettings.external_link_popup.popups.length;i++){popup=drupalSettings.external_link_popup.popups[i];if(popup.domains!=='*'&&!Drupal.behaviors.externalLinkPopup.inDomain(domain,popup.domains.split(/\s*,\s*|\s+/)))continue;e.preventDefault();return Drupal.behaviors.externalLinkPopup.openDialog(link,popup,domain);}});});Drupal.announce(providerSettings.modal.description);}},doConsentCallback:async function(consentCallback,provider,target){try{await this.loadPlayerAPI(provider);}catch(e){throw e;}this.removeConsentOverlay(target);consentCallback&&consentCallback();},initIframe:async function(iframe,passedOptions={}){const options={showModal:false,withCloseButton:true,withDefaultOverlay:true,displayErrorModal:true,...passedOptions};const {domain,video_id,provider}=this.isManagedIframe(iframe);if(!domain||!video_id)return;if(!this.isProviderEnabled(provider))return;if(!iframe.id)iframe.id=this.genUID("otsk-player-");iframe.style.display="none";this.makeResponsiveIframe(iframe);const img=await this.getThumbnailImgForIframe(iframe);iframe.parentNode.append(img);const imgOverlay=this.getOverlayImage(provider);if(imgOverlay){imgOverlay.classList.add(this.thumbnailOverlayClassname);iframe.parentNode.classList.add(this.thumbnailOverlayCustomClassname);iframe.parentNode.append(imgOverlay);}else{if(options.withDefaultOverlay){iframe.parentNode.classList.add(this.thumbnailOverlayDefaultClassname);this.videoOverlayResizeObserver.observe(iframe.parentNode);}}const imgClickListener=async()=>{const target=iframe.parentNode;try{const consentCallback=async()=>{target.classList.remove(this.thumbnailOverlayCustomClassname,this.thumbnailOverlayDefaultClassname);imgOverlay&&imgOverlay.remove();img.remove();this.playIframeVideo(iframe);const e=new Event("loadPlayer");e.id=target.getAttribute("id");document.dispatchEvent(e);};await this.doConsentModal({target,provider,consentCallback,...options});}catch(e){this.printError(`initIframe: caught error: ${e}`);if(options.displayErrorModal)this.doErrorModal({target,...options});}};const imgKeyupListener=async(e)=>{if("Enter"===e.key)e.target.click();};img.addEventListener("click",imgClickListener);img.addEventListener("keydown",imgKeyupListener);img.setAttribute("role","button");img.setAttribute("tabindex","0");if(provider===this.providers.YOUTUBE){const consentCategoryId=this.getConsentCategoryForProvider(provider);const isConsented=await this.isConsentedToCategory(consentCategoryId);if(isConsented)img.click();}if(options.showModal)img.click();},initReactPlayer:async function(reactPlayerWrapper,passedOptions={}){const options={showModal:false,withCloseButton:true,withDefaultOverlay:true,displayErrorModal:true,...passedOptions};const playerId=reactPlayerWrapper.parentNode.id;const video=drupalSettings.react_videos?.videos_list[playerId];const player=reactPlayerWrapper.querySelector(".react-player");if(player)return;if(!video)return;const {domain,video_id,provider}=this.isManagedSrc(video.url);if(!domain||!video_id)return;const preview=reactPlayerWrapper.querySelector(".react-player-preview");const imgOverlay=this.getOverlayImage(provider);if(imgOverlay){imgOverlay.classList.add(this.thumbnailOverlayClassname);reactPlayerWrapper.classList.add(this.thumbnailOverlayCustomClassname);reactPlayerWrapper.append(imgOverlay);}else{if(options.withDefaultOverlay){reactPlayerWrapper.classList.add(this.thumbnailOverlayDefaultClassname);this.videoOverlayResizeObserver.observe(reactPlayerWrapper);}}const previewClickListener=async()=>{const target=reactPlayerWrapper;try{const consentCallback=()=>{target.classList.remove(this.thumbnailOverlayCustomClassname,this.thumbnailOverlayDefaultClassname);imgOverlay&&imgOverlay.remove();const e=new Event("loadPlayer");e.id=target.getAttribute("id");document.dispatchEvent(e);};await this.doConsentModal({target,provider,consentCallback,...options});}catch(e){this.printError(`initReactPlayer: caught error: ${e}`);if(options.displayErrorModal)this.doErrorModal({target,...options});}};const previewKeyupListener=async(e)=>{if("Enter"===e.key)e.target.click();};preview.addEventListener("click",previewClickListener);preview.addEventListener("keydown",previewKeyupListener);preview.setAttribute("role","button");preview.setAttribute("tabindex","0");if(options.showModal)preview.click();},initBuzzsproutScript:async function(script,passedOptions={}){const options={showModal:true,withCloseButton:true,withDefaultOverlay:true,displayErrorModal:true,...passedOptions};const dataSrc=script.getAttribute("data-src");const {provider}=this.isManagedSrc(dataSrc);if(provider!==this.providers.BUZZSPROUT){this.throwError("initBuzzsproutScript: invalid script element");return;}const consentCategoryId=this.getConsentCategoryForProvider(provider);let isConsented=false;try{isConsented=await this.isConsentedToCategory(consentCategoryId);}catch(e){}if(isConsented){this.insertScript(script);return;}const url=new URL(dataSrc);const container_id=url.searchParams.get("container_id");const buzzsproutWrapper=document.getElementById(container_id);const imgOverlay=this.getOverlayImage(provider);if(imgOverlay){buzzsproutWrapper.classList.add(this.buzzsproutPlaceholderCustomClassname);buzzsproutWrapper.append(imgOverlay);}else{if(options.withDefaultOverlay)buzzsproutWrapper.classList.add(this.buzzsproutPlaceholderDefaultClassname);}const wrapperClickListener=async()=>{const target=buzzsproutWrapper;try{const consentCallback=()=>{target.classList.remove(this.buzzsproutPlaceholderCustomClassname,this.buzzsproutPlaceholderDefaultClassname);imgOverlay&&imgOverlay.remove();this.insertScript(script);};await this.doConsentModal({target,provider,consentCallback,...options});}catch(e){this.printError(`initBuzzsproutScript: caught error: ${e}`);if(options.displayErrorModal)this.doErrorModal({target,...options});}};const wrapperKeyupListener=async(e)=>{if("Enter"===e.key)e.target.click();};buzzsproutWrapper.addEventListener("click",wrapperClickListener);buzzsproutWrapper.addEventListener("keydown",wrapperKeyupListener);buzzsproutWrapper.setAttribute("role","button");buzzsproutWrapper.setAttribute("tabindex","0");if(options.showModal)buzzsproutWrapper.click();},deinitBuzzsproutScript:function(script){const dataSrc=script.getAttribute("data-src");const {provider}=this.isManagedSrc(dataSrc);if(provider!==this.providers.BUZZSPROUT){this.throwError("deinitBuzzsproutScript: invalid script element");return;}const url=new URL(dataSrc);const container_id=url.searchParams.get("container_id");const buzzsproutWrapper=document.getElementById(container_id);const imgOverlay=buzzsproutWrapper.querySelector(".otsuka-pcm-img-overlay");imgOverlay&&imgOverlay.remove();buzzsproutWrapper.classList.remove(this.buzzsproutOverlayDefaultClassname);this.removeConsentOverlay(buzzsproutWrapper);},initOrbitaScript:async function(script,passedOptions={}){const options={displayErrorModal:false,...passedOptions,withCloseButton:true};const dataSrc=script.getAttribute("data-src");const {provider}=this.isManagedSrc(dataSrc);if(provider!==this.providers.ORBITA){this.throwError("initOrbitaScript: invalid script element");return;}const orbitaSettings=this.getProviderSettings(this.providers.ORBITA);const consentCategoryId=this.getConsentCategoryForProvider(provider);let isConsented=false;try{isConsented=await this.isConsentedToCategory(consentCategoryId);}catch(e){if(!options.displayErrorModal)throw e;}if(isConsented){this.insertScript(script);return;}const widget=this.createElementFromText(orbitaSettings.widget.html);const styles=this.createElementFromText(orbitaSettings.widget.css,"style",false);const chatbotWrapper=document.getElementById(orbitaSettings.widget.wrapper_id);chatbotWrapper.appendChild(widget);chatbotWrapper.appendChild(styles);const widgetClickListener=async()=>{const target=document.body;try{const consentCallback=async()=>{widget&&widget.remove();this.insertScript(script);await this.awaitOrbitaChatbot();const orbitaButton=await this.awaitOrbitaChatButton();orbitaButton.click();};await this.doConsentModal({target,provider,consentCallback,...options});}catch(e){this.printError(`initOrbitaScript: caught error: ${e}`);if(options.displayErrorModal)this.doErrorModal({target,...options});}};const widgetKeyupListener=async(e)=>{if("Enter"===e.key)e.target.click();};widget.addEventListener("click",widgetClickListener);widget.addEventListener("keydown",widgetKeyupListener);widget.setAttribute("role","button");widget.setAttribute("tabindex","0");},initScript:async function(script,passedOptions={}){const options={showModal:true,withCloseButton:true,...passedOptions};const {provider}=this.isManagedSrc(script.getAttribute("data-src"));if(!provider)return;try{switch(provider){case this.providers.BUZZSPROUT:await this.initBuzzsproutScript(script,options);break;case this.providers.ORBITA:await this.initOrbitaScript(script,options);break;}}catch(e){throw e;}}});;
